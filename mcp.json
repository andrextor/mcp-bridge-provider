{
  "name": "mcp-bridge-provider",
  "version": "1.0.0",
  "description": "MCP provider for interacting with MCP Bridge API (Checkout, Gateway, and more).",
  "entry_point": "index.js",
  "capabilities": {
    "tools": {},
    "logging": {}
  },

  "definitions": {
    "Buyer": {
      "type": "object",
      "properties": {
        "name": { "type": "string" },
        "surname": { "type": "string" },
        "email": { "type": "string", "format": "email" },
        "document": { "type": "string" },
        "documentType": { "type": "string" },
        "mobile": { "type": "number" }
      },
      "required": [
        "name",
        "surname",
        "email",
        "document",
        "documentType",
        "mobile"
      ]
    },

    "Amount": {
      "type": "object",
      "properties": {
        "currency": { "type": "string" },
        "total": { "type": "number" }
      },
      "required": ["currency", "total"]
    },

    "Payment": {
      "type": "object",
      "properties": {
        "reference": { "type": "string" },
        "description": { "type": "string" },
        "amount": { "$ref": "#/definitions/Amount" },
        "subscribe": { "type": "boolean" }
      },
      "required": ["reference", "description", "amount", "subscribe"]
    },

    "BaseRequest": {
      "type": "object",
      "properties": {
        "locale": { "type": "string" },
        "ipAddress": { "type": "string" },
        "returnUrl": { "type": "string", "format": "uri" },
        "userAgent": { "type": "string" }
      },
      "required": ["locale", "ipAddress", "returnUrl", "userAgent"]
    },

    "Subscription": {
      "type": "object",
      "properties": {
        "reference": { "type": "string" },
        "description": { "type": "string" }
      },
      "required": ["reference", "description"]
    }
  },

  "tools": {
    "settings.setIdentifier": {
      "description": "Stores your MCP identifier (SSH public key ID) so all future requests include it automatically.",
      "input_schema": {
        "type": "object",
        "properties": {
          "identifier": {
            "type": "string",
            "description": "Your MCP Bridge identifier (linked to your public key).",
            "minLength": 5
          }
        },
        "required": ["identifier"]
      }
    },

    "checkout.create": {
      "description": "Creates a checkout session using MCP Bridge API.",
      "input_schema": {
        "type": "object",

        "properties": {
          "identifier": {
            "type": "string",
            "description": "Your MCP identifier provided via settings.setIdentifier. Optional because it can be preloaded."
          },

          "environment": {
            "type": "string",
            "enum": ["TEST", "DEVELOP", "UAT", "LOCAL"]
          },

          "site": {
            "type": "object",
            "description": "Selects the user site. Only one field is allowed.",
            "properties": {
              "id": {
                "type": "number",
                "description": "Exact site ID registered by the user."
              },
              "name": {
                "type": "string",
                "description": "Partial or full name of the site."
              },
              "country": {
                "type": "string",
                "description": "Country of the site (auto-resolves environment)."
              }
            },
            "oneOf": [
              { "required": ["id"] },
              { "required": ["name"] },
              { "required": ["country"] }
            ],
            "additionalProperties": false
          },

          "payload": {
            "description": "PlacetoPay request body. MUST be either a PaymentRequest (with a 'payment' object) or a SubscriptionRequest (with a 'subscription' object). Do NOT send flat fields like {\"amount\": 20000, \"currency\": \"COP\", \"email\": \"...\"}. Always nest amount and currency inside 'payment', and email inside 'buyer'.",
            "oneOf": [
              {
                "title": "PaymentRequest",
                "type": "object",
                "description": "Use this shape to create a payment session. Always include a 'payment' object, and put the customer email inside 'buyer.email'.",
                "allOf": [{ "$ref": "#/definitions/BaseRequest" }],
                "properties": {
                  "buyer": {
                    "description": "Buyer information. Put email, name, document, etc. here.",
                    "oneOf": [
                      { "$ref": "#/definitions/Buyer" },
                      { "type": "null" }
                    ]
                  },
                  "payment": {
                    "description": "Payment details. 'amount' and 'currency' MUST be nested here, not at the top level.",
                    "$ref": "#/definitions/Payment"
                  },
                  "paymentMethod": {
                    "type": ["string", "null"],
                    "description": "Preferred payment method or null."
                  },
                  "skipResult": {
                    "type": "boolean",
                    "description": "If true, do not show result page.",
                    "default": false
                  },
                  "noBuyerFill": {
                    "type": "boolean",
                    "description": "If true, do not prefill buyer info.",
                    "default": false
                  },
                  "captureAddress": {
                    "type": "boolean",
                    "description": "If true, capture address in the form.",
                    "default": false
                  },
                  "notificationUrl": {
                    "type": "string",
                    "format": "uri",
                    "description": "Webhook URL for notifications."
                  },
                  "metadata": {
                    "type": "object",
                    "description": "Free-form metadata sent to PlacetoPay.",
                    "additionalProperties": true
                  }
                },
                "required": ["payment"],
                "additionalProperties": false,
                "examples": [
                  {
                    "locale": "es_CO",
                    "ipAddress": "181.137.193.33",
                    "returnUrl": "https://mysite.com/response",
                    "userAgent": "PlacetoPay Sandbox",
                    "buyer": {
                      "name": "Andres",
                      "surname": "Lopez",
                      "email": "andres3@yopmail.com",
                      "document": "123456",
                      "documentType": "CC",
                      "mobile": "+573005156705"
                    },
                    "payment": {
                      "description": "Pago de prueba 20.000 COP",
                      "reference": "Ref-2025-ANDRES-20K",
                      "amount": {
                        "currency": "COP",
                        "total": 20000
                      },
                      "allowPartial": false,
                      "subscribe": false
                    },
                    "skipResult": false,
                    "payload": false,
                    "noBuyerFill": false,
                    "captureAddress": false,
                    "_paymentMethod": "cash",
                    "notificationUrl": "https://example.test/notification",
                    "paymentMethod": null,
                    "metadata": {
                      "initiatorIndicator": "CARDHOLDER_COF"
                    }
                  }
                ]
              },
              {
                "title": "SubscriptionRequest",
                "type": "object",
                "description": "Use this shape to create a subscription. MUST contain a 'subscription' object.",
                "properties": {
                  "subscription": {
                    "$ref": "#/definitions/Subscription",
                    "description": "Subscription details."
                  }
                },
                "required": ["subscription"],
                "additionalProperties": false,
                "examples": [
                  {
                    "subscription": {
                      "reference": "plan-001",
                      "description": "Plan mensual"
                    }
                  }
                ]
              }
            ]
          }
        },

        "required": ["environment", "site", "payload"]
      }
    }
  }
}
